<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>연애 시뮬레이션</title>
  <style>
/* 공통 설정 */
* {margin: 0;padding: 0;box-sizing: border-box;}

/* 폰트 */
@font-face {
  font-family: 'DungGeunMo';
  src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
  font-weight: normal;
  font-style: normal;
}

body, html {
  height: 100%;
  width: 100%;
  background: #008080;
  font-family: 'Courier New', monospace;
}

/* 기본 창 구성 */
.window-frame {
  position: relative;
  width: 800px;
  height: 600px;
  margin: 30px auto;
  border: 3px solid #F7F7F7;
  box-shadow: 8px 8px 0 #404040;
  background: #c0c0c0;
  display: flex;
  flex-direction: column;
}

.title-bar {
  background: #000080;
  color: #fff;
  padding: 6px 12px;
  font: normal 12px 'DungGeunMo', monospace;
}

.content-area {
  position: relative;
  flex: 1;
  overflow: hidden;
}

/* 배경 이미지 설정 */
.blur-bg {
  filter: blur(4px);
  position: absolute;
  max-height: 100%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: contain;
  z-index: 0;
}

.no-blur {
  filter: none;
  position: absolute;
  max-height: 100%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: contain;
  z-index: 0;
}

/* 상태 패널 (호감도 등) */
.status-panel {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.5);
  color: #fff;
  padding: 8px 12px;
  border: 1px solid #fff;
  font: 14px/1.4 'DungGeunMo', monospace;
  z-index: 10;
  width: 160px;
}

.affection {
  margin-top: 6px;
  cursor: pointer;
}

.affection-bar {
  width: 100%;
  height: 8px;
  background: #333;
  border: 1px solid #aaa;
  margin-top: 4px;
}

.affection-fill {
  height: 100%;
  background: #ff5e99;
  transition: width 0.4s ease;
}

/* 호감도 설명 팝업 */
.affection-info-window {
  position: absolute;
  top: 180px;
  left: 20px;
  width: 280px;
  background: #c0c0c0;
  border: 3px solid #808080;
  box-shadow: 4px 4px 0 #404040;
  font-family: 'DungGeunMo', monospace;
  z-index: 20;
}

.popup-title {
  background: #000080;
  color: #fff;
  padding: 4px 8px;
  font: 14px 'DungGeunMo', monospace;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.popup-close {
  cursor: pointer;
}

.popup-content {
  padding: 12px;
  background: #e0e0e0;
  color: #000;
  font: 13px 'DungGeunMo', monospace;
}

/* 캐릭터 이미지 */
.character {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  height: 100%;
  max-height: 100%;
  object-fit: contain;
  z-index: 4;
}

/* 대화창 */
.dialogue-box {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 120px; 
  background: rgba(0,0,0,0.7);
  color: #fff;
  padding: 16px 20px;
  font-size: 16px;
  line-height: 1.5;
  border-top: 2px solid #fff;
  z-index: 10;
  font-family: 'DungGeunMo', monospace;
}

.character-name {
  font-weight: bold;
  color: #0ff;
  margin-bottom: 6px;
}

.next-button {
  display: inline-block;
  margin-top: 10px;
  color: #ff0;
  cursor: pointer;
  font: bold 18px 'DungGeunMo', monospace;
}

/* 어두운 화면 연출 (컷신 등) */
.dim-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  z-index: 5;
  display: none;
}

/* 선택지 박스 */
#choiceBox {
  display: none;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: 'DungGeunMo', monospace;
  z-index: 30;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

#choiceBox button {
  padding: 12px 20px;
  background: rgba(0, 0, 0, 0.7);
  border: 2px solid #fff;
  color: #fff;
  font-family: 'DungGeunMo', monospace;
  font-size: 16px;
  cursor: pointer;
  width: 300px;
  text-align: center;
  transition: background 0.2s;
}

#choiceBox button:hover {
  background: rgba(0, 0, 0, 0.2);
}

/* 사이드 버튼 영역 (메모장 등) */
.side-buttons {
  position: fixed;
  top: 10px;
  left: 10px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  z-index: 50;
}

.side-buttons button {
  width: 60px;
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
}

.side-buttons img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* 메모장 팝업 */
.notepad-popup {
  position: absolute;
  top: 80px;
  left: 100px;
  width: 320px;
  background: #F7F7F7;
  border: 3px solid #F7F7F7;
  box-shadow: 4px 4px 0 #404040;
  font-family: 'DungGeunMo', monospace;
  z-index: 999;
}

.notepad-popup .popup-title {
  background: #000080;
  color: white;
  padding: 6px 10px;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.notepad-popup .popup-close {
  cursor: pointer;
}

.notepad-popup .popup-content {
  padding: 12px;
  background: #e0e0e0;
  color: black;
  font-size: 13px;
  line-height: 1.5;
}

  </style>
</head>
<body>

<!-- ⚙️ 사이드 버튼들 (좌측 고정) -->
<div class="side-buttons">
  <button onclick="location.href='info.html'"><img src="이미지/내컴퓨터.png" alt="내 컴퓨터"></button>
  <button><img src="이미지/인터넷.png" alt="인터넷"></button>
  <button><img src="이미지/메모장.png" alt="메모장"></button>
  <button><img src="이미지/폴더.png" alt="폴더"></button>
  <button onclick="location.href='home.html'"><img src="이미지/휴지통.png" alt="휴지통"></button>
  <button onclick="location.href='index.html'"><img src="이미지/카라양양.png" alt="카라양양"></button>
</div>

<!-- 🖥 메인 게임 화면 -->
<div class="window-frame">
  <div class="title-bar">💾 잃어버린 눈 찾기 대-소-동!</div>
  <div class="content-area">
    <!-- 배경 이미지 -->
    <img id="background" src="이미지/배경.png" class="blur-bg" alt="배경">

    <!-- 캐릭터 이미지 -->
    <img id="charImg" class="character" src="이미지/초기.png" alt="캐릭터">

    <!-- 어두운 화면 오버레이 -->
    <div id="dimOverlay" class="dim-overlay"></div>

    <!-- 배경 음악 (숨김) -->
    <iframe width="0" height="0" 
      src="https://www.youtube.com/embed/wefAT9LZ_BM?autoplay=1&loop=1&playlist=wefAT9LZ_BM" 
      frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

    <!-- 상태 표시 (날짜/호감도) -->
    <div class="status-panel" id="statusPanel">
      <div id="gameDate">13월 7일</div>
      <div id="affection" class="affection">
        호감도 ♥ <span id="affectionValue">5</span>
        <div class="affection-bar">
          <div id="affectionFill" class="affection-fill" style="width:5%"></div>
        </div>
      </div>
    </div>

    <!-- 호감도 팝업 정보창 -->
    <div id="affectionInfo" class="affection-info-window" style="display:none;">
      <div class="popup-title">💬 호감도 정보 <span id="closeAffectionInfo" class="popup-close">X</span></div>
      <div id="affectionInfoContent" class="popup-content"></div>
    </div>

    <!-- 대화창 -->
    <div class="dialogue-box" id="dialogueBox">
      <div id="charName" class="character-name">양양</div>
      <div id="dialogueText" class="dialogue-text">시작 대사</div>
      <div id="nextBtn" class="next-button">▼</div>
    </div>

    <!-- 선택지 박스 -->
    <div id="choiceBox"></div>
  </div>
</div>

  <!-- 📝 메모장 팝업 -->
<div id="notepadPopup" class="notepad-popup" style="display:none;">
  <div class="popup-title">📝 제목 없음 <span id="closeNotepad" class="popup-close">X</span></div>
  <div class="popup-content">
    내 컴퓨터를 누르면 캐릭터 정보를 확인.<br>
    휴지통을 누르면 시뮬레이션 초기화.<br>
    페어 아이콘을 누르면 메인 화면으로 돌아갑니다.
  </div>
</div>

<!-- 스크립트 시작 -->
<script>
// 메모장 팝업 관련
const notepadPopup = document.getElementById('notepadPopup');
const closeNotepad = document.getElementById('closeNotepad');
const memoBtn = document.querySelector('img[alt="메모장"]').parentElement;

memoBtn.addEventListener('click', () => {
  notepadPopup.style.display = 'block';
});
closeNotepad.addEventListener('click', () => {
  notepadPopup.style.display = 'none';
});

// 기본 변수들
let index = 0;
let affection = 5;
let choiceShown = false;

// 대사 배열
let dialogues = [
  { name: '-', text: '평화로운 하늘 위' },
  { name: '-', text: '약속 시간이 다 되었건만 통 오질 않는 악마 하나를 기다리는 중이다.' },
  { name: '-', text: '평소에는 휴대용 통신기기로 곧잘 떠들어대더니 왜 이럴 때만 아무 소식이 없는지.' },
  { name: '-', text: '답답했지만 통신기기로 먼저 말을 거는 건 내키지 않았다.' },
  { name: '-', text: '이대로 오마에와 시간을 보내는 것도 좋았으니까.' },
  { name: '-', text: '만지작 보들보들 쓰담쓰담 복복' },
  { name: '-', text: '한참 손길을 따라 품속에서 꾸물거리던 오마에가 끝내 잠에 들려는 순간' },
  { name: '??', text: '카라사키 님...---!!' },
  { name: '-', text: '익숙한 목소리가 다급하게 이름을 부른다.' },
  { name: '-', text: '… 어떻게 하지?', choice: true },
];

// 분기 시나리오들
const branchA = [
  { name: '-', text: '약속에 늦었으면 재깍 올 것인지 어디서 부르는 건지.'},
  { name: '-', text: '잠에서 깨버린 오마에를 어와 둥둥 달래주면서 기다리기로 했다.' },
  { name: '-', text: '아이귀여워!'},
  { name: 'SYSTEM', text: '그 후로 양양이는 당최 어디에 있는지 보이지 않았다.',
    img: '이미지/게임오버.png', end: true },
];

const branchB = [
  { name: '-', text: '일단 깨어난 오마에를 토닥이며 안아들고 다급한 목소리를 따라갔다.'},
  { name: '-', text: '멀지 않은 곳에 익숙한 뱀이 마중을 나온 것처럼 앞에 나타났고,' },
  { name: '-', text: '그 뒤로 주저 앉아있는 양양이 보였다.', bg: '이미지/컷씬.png' }, 
  { name: '양양', text: '카라사키 님, 카라사키 님인가요?' }, 
  { name: '카라사키', text: '거기서 왜 그러고 있는 거냐.' },
  { name: '양양', text: '큰일이에요...! 저, 눈을 잃어버렸다구요...!?', bg: '이미지/배경.png', img: '이미지/눈물1.png' },
  { name: '-', text: '양양의 눈이라 하면 이미 잃어버린지 오래 아니었나?', img: '이미지/눈물1.png' }, 
  { name: '양양', text: '하늘 위 공기가 익숙하지 않았는지 흑흑이가 감기에 걸려서...', img: '이미지/눈물1.png' },
  { name: '양양', text: '기침을 하다가 그만, 제 눈을 토해버렸어요...!', img: '이미지/눈물2.png' },
  { name: '-', text: '황당한 이야기에 이마를 짚었다.', img: '이미지/눈물2.png' },
  { name: '-', text: '뭐라고 위로해야 하지?.', img: '이미지/눈물2.png', choice: 'B1' },
];

const branchB1 = [
  { name: '양양', text: '정말인가요, 카라사키 님...?', img: '이미지/눈물1.png' }, 
  { name: '카라사키', text: '당연한 걸 그렇게까지;', img: '이미지/눈물1.png' }, 
  { name: '양양', text: '하지만 전 흑흑이가 눈을 잃어버린 이후로 아무것도 보이지 않게 됐으니까요...?', img: '이미지/눈물1.png' },
  { name: '양양', text: '아무 도움도 드릴 수 없다구요...?', img: '이미지/눈물1.png' },
  { name: '-', text: '어쩐지 그저 주저앉아 있더라니.' }, 
  { name: '-', text: '이상한 시야에는 적응되었다고 해도 보이지 않는 건 다른 문제인가.' }, 
  { name: '카라사키', text: '도움은 됐으니까 돌아가서 쉬어라.' },
  { name: '카라사키', text: '집까지 같이 가지.' },
  { name: '양양', text: '...', img: '이미지/눈물1.png' }, 
  { name: '양양', text: '저 도움은 안 되겠지만', img: '이미지/눈물1.png' }, 
  { name: '양양', text: '그냥 카라사키 님과 함께 있으면 안 될까요...?', img: '이미지/눈물1.png', choice: 'C' }, 
];

const branchB2 = [
  { name: '양양', text: '그게...', img: '이미지/눈물2.png' },
  { name: '양양', text: '앞이 보이지 않는걸요...?', img: '이미지/눈물2.png' },
  { name: '카라사키', text: '앞이?', img: '이미지/눈물2.png' },
  { name: '양양', text: '흑흑이가 눈을 잃어버린 이후로 문제가 생긴 것 같아요...', img: '이미지/눈물2.png' },
  { name: '-', text: '어쩐지 그저 주저앉아 있더라니.' }, 
  { name: '-', text: '이상한 시야에는 적응되었다고 해도 보이지 않는 건 다른 문제인가.' }, 
  { name: '카라사키', text: '눈은 내가 찾아볼 테니까 돌아가서 쉬어라.' },
  { name: '카라사키', text: '집까지 같이 가지.' },
  { name: '양양', text: '...', img: '이미지/눈물1.png' }, 
  { name: '양양', text: '저 도움은 안 되겠지만', img: '이미지/눈물1.png' }, 
  { name: '양양', text: '그냥 카라사키 님과 함께 있으면 안 될까요...?', img: '이미지/눈물1.png', choice: 'C' }, 
];

const branchC1 = [
  { name: '양양', text: '네...', img: '이미지/눈물1.png' },
  { name: 'SYSTEM', text: '당신은 양양을 그의 집까지 바래다 주었다.' },
  { name: 'SYSTEM', text: '눈에 민감하게 굴던 악마였으니 지금은 안정이 더 필요하다 판단했던 거였다.' }, 
  { name: 'SYSTEM', text: '그 후 혼자서 양양의 눈을 찾아다녔으나 넓은 하늘을 전부 뒤지기엔 역부족이었다.',
    img: '이미지/게임오버.png', end: true },
];

const branchC2 = [
  { name: '카라사키', text: '그래. 옆에 있어라. 네 눈인데 네가 더 잘 알겠지...', img: '이미지/눈물1.png' },
  { name: '양양', text: '네...!', img: '이미지/웃음.png' },
  { name: 'SYSTEM', text: '양양이 당신을 향해 손을 내밀었고, 당신은 그 손을 붙잡아 자리에서 일으켜 주었다.', img: '이미지/웃음.png' },
  { name: '카라사키', text: '그럼 일단... 눈은 이 자리에서 잃어버린 거냐?', img: '이미지/웃음.png' },
  { name: '양양', text: '맞아요. 하지만 흑흑이 뱉어버리면서 멀리 날아가버렸다고 생각해요.', img: '이미지/서운.png' },
];
  

// 요소 가져오기
const nameEl  = document.getElementById('charName');
const textEl  = document.getElementById('dialogueText');
const imgEl   = document.getElementById('charImg');
const nextBtn = document.getElementById('nextBtn');
const dimOv   = document.getElementById('dimOverlay');
const choiceBox = document.getElementById('choiceBox');
const affVal  = document.getElementById('affectionValue');
const affFill = document.getElementById('affectionFill');
const affBox  = document.getElementById('affection');
const infoWin = document.getElementById('affectionInfo');
const infoTxt = document.getElementById('affectionInfoContent');
const infoX   = document.getElementById('closeAffectionInfo');
const bgElement = document.getElementById('background');

// 호감도 설명 반환
function affectionMessage(v){
  if(v >= 80) return '사랑해서 주체하지 못하는 중.';
  if(v >= 50) return '사랑스러운 연인이라고 생각하는 중.';
  if(v >= 20) return '고마운 연인이라고 생각하는 중.';
  return '그저 연인이라고 생각하는 중.';
}

// 호감도 UI 업데이트
function updateAffectionUI(){
  affVal.textContent = affection;
  affFill.style.width = `${affection}%`;
}

function updateDialogue() {
  const d = dialogues[index];
  nameEl.textContent = d.name;
  textEl.textContent = d.text;

  // ✅ 캐릭터 이미지 처리
  if (d.img) {
    imgEl.src = d.img;
    imgEl.style.display = 'block'; // 이미지 표시
  } else {
    imgEl.style.display = 'none';  // 이미지 숨김
  }

  // ✅ 날짜 업데이트
  if (d.date) {
    document.getElementById('gameDate').textContent = d.date;
  }

  // ✅ 어두운 화면 연출
  dimOv.style.display = d.dim ? 'block' : 'none';


  // ✅ 배경 이미지 변경
  if (d.bg) {
    bgElement.src = d.bg;

    // 컷씬 배경인 경우 (파일명에 '컷씬'이 포함된 경우)
    if (d.bg.includes('컷씬')) {
      bgElement.classList.remove('blur-bg');
      bgElement.classList.add('no-blur');
    } else {
      bgElement.classList.remove('no-blur');
      bgElement.classList.add('blur-bg');
    }
  }

  dimOv.style.display = d.dim ? 'block' : 'none';
}

// 선택지 표시 여부 판단
function maybeShowChoice() {
  const d = dialogues[index];
  
  if (d.choice === true) {
    choiceBox.innerHTML = `
      <button onclick="choose(-5, 'A')">잠에서 깬 오마에를 달래준다.</button>
      <button onclick="choose(10, 'B')">목소리의 출처를 찾아간다.</button>
    `;
    choiceBox.style.display = 'flex';
    nextBtn.style.display = 'none';
    choiceShown = true;
    
   } else if (d.choice === 'B1') {
    choiceBox.innerHTML = `
      <button onclick="choose(5, 'B1')">찾아줄 테니까 진정해라.</button>
      <button onclick="choose(-5, 'B2')">찾아야지 왜 주저앉아 있는 거냐.</button>
    `;
    choiceBox.style.display = 'flex';
    nextBtn.style.display = 'none';
    choiceShown = true;
    
    } else if (d.choice === 'C') {
    choiceBox.innerHTML = `
      <button onclick="choose(3, 'C1')">집에서 쉬는 게 안전할 거다...</button>
      <button onclick="choose(5, 'C2')">양양이 도움이 될지도 모른다...</button>
    `;
    choiceBox.style.display = 'flex';
    nextBtn.style.display = 'none';
    choiceShown = true;
  }
}

// 선택지 처리
function choose(delta, branch){
  affection = Math.max(0, Math.min(100, affection + delta));
  updateAffectionUI();
  choiceBox.style.display = 'none';
  nextBtn.style.display = 'block';
  choiceShown = false;

  if (branch === 'A')      dialogues = branchA;
  else if (branch === 'B') dialogues = branchB;
  else if (branch === 'B1') dialogues = branchB1;
  else if (branch === 'B2') dialogues = branchB2;
  else if (branch === 'C1') dialogues = branchC1;
  else if (branch === 'C2') dialogues = branchC2;

  index = 0;
  updateDialogue();
  maybeShowChoice();
}

// 다음 버튼 동작
nextBtn.addEventListener('click', () => {
  if (choiceShown) return;
  index++;
  if (index < dialogues.length) {
    updateDialogue();
    maybeShowChoice();
  } else {
    const d = dialogues[index - 1];
    if (d.end) {
      alert('배드 엔딩입니다. 다시 시도해보세요.');
      location.reload();
    } else {
      alert('플레이해주셔서 감사합니다.');
    }
  }
});

// 호감도 박스 클릭 시 정보 팝업 표시
affBox.addEventListener('click', ()=>{
  infoTxt.innerHTML = `현재 호감도는 ${affection}입니다.<br>당신을 ${affectionMessage(affection)}`;
  infoWin.style.display = 'block';
});
infoX.addEventListener('click', ()=> infoWin.style.display = 'none');

// 초기 실행
updateAffectionUI();
updateDialogue();
</script>

</body>
</html>
